
<template name="cardAttachmentsPopup">
  {{#if $gt uploads.length 0}}
    <div class="attachment-upload">{{_ 'uploading'}}
      <table>
        <tr>
          <th class="upload-file-name-descr">{{_ 'name'}}</th>
          <th class="upload-progress-descr">{{_ 'progress'}}</th>
          <th class="upload-remaining-descr">{{_ 'remaining_time'}}</th>
          <th class="upload-speed-descr">{{_ 'speed'}}</th>
        </tr>
        {{#each upload in uploads}}
          <tr>
            <td class="upload-file-name-value">{{upload.file.name}}</td>
            <td class="upload-progress-value">{{upload.progress.get}}%</td>
            <td class="upload-remaining-value">{{getEstimateTime upload}}</td>
            <td class="upload-speed-value">{{getEstimateSpeed upload}}</td>
          </tr>
        {{/each}}
      </table>
    </div>
  {{else}}
    <ul class="pop-over-list">
      <li>
        <input class="js-attach-file hide" type="file" name="file" multiple>
        <a class="js-computer-upload">{{_ 'computer'}}</a>
      </li>
      <li>
        <a class="js-upload-clipboard-image">{{_ 'clipboard'}}</a>
      </li>
    </ul>
  {{/if}}
</template>

<template name="previewClipboardImagePopup">
  <p><kbd>Ctrl</kbd>+<kbd>V</kbd> {{_ "paste-or-dragdrop"}}</p>
  <img class="preview-clipboard-image">
  <button class="primary js-upload-pasted-image">{{_ 'upload'}}</button>
</template>

<template name="attachmentDeletePopup">
  <p>{{_ "attachment-delete-pop"}}</p>
  <button class="js-confirm negate full" type="submit">{{_ 'delete'}}</button>
</template>

<template name="attachmentViewer">
  <div id="viewer-overlay" class="hidden">
    <div id="viewer-top-bar">
      <span id="attachment-name"></span>
      <a id="viewer-close" class="fa fa-times-thin"></a>
    </div>
    <div id="viewer-container">
      <i class="fa fa-chevron-left attachment-arrow" id="prev-attachment"></i>
      <div id="viewer-content">
        <img id="image-viewer" class="hidden">
        <video id="video-viewer" class="hidden" controls="true"></video>
        <audio id="audio-viewer" class="hidden" controls="true"></audio>
        <object id="pdf-viewer" class="hidden" type="application/pdf">
          <span class="pdf-preview-error">{{_ 'preview-pdf-not-supported'}}</span>
        </object>
        <object id="txt-viewer" class="hidden" type="text/plain"></object>
      </div>
      <i class="fa fa-chevron-right attachment-arrow" id="next-attachment"></i>
    </div>
  </div>
</template>

<template name="attachmentGallery">
  <div class="attachment-gallery">
    {{#if canModifyCard}}
      <a class="attachment-item add-attachment js-add-attachment">
        <i class="fa fa-plus icon"></i>
      </a>
    {{/if}}

    {{#each attachments}}
      <div class="attachment-item">
        <div class="attachment-thumbnail-container open-preview" data-attachment-id="{{_id}}" data-card-id="{{meta.cardId}}">
          {{#if link}}
            {{#if isImage}}
              <img class="attachment-thumbnail" src="{{link}}" title="{{sanitize name}}">
            {{else if $eq extension 'svg'}}
              <img class="attachment-thumbnail" src="{{link}}" title="{{sanitize name}}" type="image/svg+xml">
            {{else if $eq extension 'mp3'}}
              <video class="attachment-thumbnail" title="{{sanitize name}}">
                <source src="{{link}}" type="audio/mpeg">
              </video>
            {{else if $eq extension 'ogg'}}
              <video class="attachment-thumbnail" title="{{sanitize name}}">
                <source src="{{link}}" type="video/ogg">
              </video>
            {{else if $eq extension 'webm'}}
              <video class="attachment-thumbnail" title="{{sanitize name}}">
                <source src="{{link}}" type="video/webm">
              </video>
            {{else if $eq extension 'mp4'}}
              <video class="attachment-thumbnail" title="{{sanitize name}}">
                <source src="{{link}}" type="video/mp4">
              </video>
            {{else}}
              <span class="attachment-thumbnail-text">{{extension}}</span>
            {{/if}}
          {{/if}}
        </div>

        <div class="attachment-details-container">
          <div class="attachment-details">
            <div>
              <b>{{name}}</b>
              <span class="file-size">({{fileSize size}})</span>
            </div>
            <div class="attachment-actions">
              <a class="js-download" href="{{link}}?download=true" download="{{name}}">
                <i class="fa fa-download icon" title="{{_ 'download'}}"></i>
              </a>
              {{#if currentUser.isBoardMember}}
                {{#unless currentUser.isCommentOnly}}
                  {{#unless currentUser.isWorker}}
                    <a class="js-rename">
                      <i class="fa fa-pencil-square-o icon" title="{{_ 'rename'}}"></i>
                    </a>
                    <a class="js-confirm-delete">
                      <i class="fa fa-trash icon" title="{{_ 'delete'}}"></i>
                    </a>
                    <a class="fa fa-navicon icon js-open-attachment-menu" data-attachment-link="{{link}}" title="{{_ 'attachmentActionsPopup-title'}}"></a>
                  {{/unless}}
                {{/unless}}
              {{/if}}
            </div>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
</template>

<template name="attachmentActionsPopup">
  <ul class="pop-over-list">
    <li>
      {{#if isImage}}
        <a class="{{#if isCover}}js-remove-cover{{else}}js-add-cover{{/if}}">
          <i class="fa fa-book"></i>
          <i class="fa fa-picture-o"></i>
          {{#if isCover}}
            {{_ 'remove-cover'}}
          {{else}}
            {{_ 'add-cover'}}
          {{/if}}
        </a>
      {{/if}}
      {{#if currentUser.isBoardAdmin}}
        {{#if isImage}}
          <a class="{{#if isBackgroundImage}}js-remove-background-image{{else}}js-add-background-image{{/if}}">
            <i class="fa fa-picture-o"></i>
            {{#if isBackgroundImage}}
              {{_ 'remove-background-image'}}
            {{else}}
              {{_ 'add-background-image'}}
            {{/if}}
          </a>
        {{/if}}

        {{#if $neq versions.original.storage "fs"}}
          <a class="js-move-storage-fs">
            <i class="fa fa-arrow-right"></i>
            {{_ 'attachment-move-storage-fs'}}
          </a>
        {{/if}}

        {{#if $neq versions.original.storage "gridfs"}}
          {{#if versions.original.storage}}
            <a class="js-move-storage-gridfs">
              <i class="fa fa-arrow-right"></i>
              {{_ 'attachment-move-storage-gridfs'}}
            </a>
          {{/if}}
        {{/if}}

        {{#if $neq versions.original.storage "s3"}}
          {{#if versions.original.storage}}
            <a class="js-move-storage-s3">
              <i class="fa fa-arrow-right"></i>
              {{_ 'attachment-move-storage-s3'}}
            </a>
          {{/if}}
        {{/if}}
      {{/if}}
    </li>
  </ul>
</template>

<template name="attachmentRenamePopup">
  <input class="js-edit-attachment-name" type="text" autofocus value="{{getNameWithoutExtension}}" dir="auto">
  <div class="edit-controls clearfix">
    <button class="primary confirm js-submit-edit-attachment-name" type="submit">{{_ 'save'}}</button>
  </div>
</template>
